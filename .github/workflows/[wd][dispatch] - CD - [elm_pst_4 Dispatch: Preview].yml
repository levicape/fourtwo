########################################
# THIS FILE WAS AUTOMATICALLY GENERATED, DO NOT MODIFY
########################################
name: "elm_pst_4 Dispatch: Preview"
on:
  workflow_dispatch:
    {}
env:
  NPM_REGISTRY_PROTOCOL_LEVICAPE: https
  NPM_REGISTRY_HOST_LEVICAPE: npm.pkg.github.com
  NPM_TOKEN_LEVICAPE: ${{ secrets.LEVICAPE_NPM_TOKEN }}
  NPM_DEFAULT: ${{ vars.NPM_MIRROR }}
  LEVICAPE_REGISTRY_HOST: npm.pkg.github.com/
  LEVICAPE_REGISTRY: https://npm.pkg.github.com
  LEVICAPE_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  NODE_NO_WARNINGS: "1"
  NPM_CONFIG_UPDATE_NOTIFIER: "false"
  FRONTEND_HOSTNAME: at.levicape.cloud
  PULUMI_CONFIG_PASSPHRASE: ${{ secrets.PULUMI_CONFIG_PASSPHRASE }}
  APPLICATION_IMAGE_NAME: fourtwo
  CI_ENVIRONMENT: elm_pst_4
  AWS_PAGER: ""
  AWS_REGION: us-west-2
  AWS_PROFILE: elm_pst_4
  PULUMI_STACK_FILTER: ${{ vars.STACK_FILTER }}
  DOCKER_NO_IMAGE: ${{ vars.NO_IMAGE }}
jobs:
  preview:
    name: Preview Pulumi Stacks
    runs-on: act-darwin-a64-atoko
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
      - name: Setup Node 22.13.0
        uses: actions/setup-node@v4
        with:
          node-version: 22.13.0
          registry-url: ${{ env.NPM_REGISTRY_PROTOCOL_LEVICAPE }}://${{ env.NPM_REGISTRY_HOST_LEVICAPE }}
          cache: pnpm
          cache-dependency-path: pnpm-lock.yaml
          scope: "@levicape"
        env:
          NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - id: cache-npm
        name: Cache node modules
        uses: actions/cache@v3
        with:
          path: ~/.npm
          key: ${{ runner.os }}-build-npm-node-modules-${{ hashFiles('**/pnpm-lock.json') }}
          restore-keys: ${{ runner.os }}-build-npm-node-modules-
      - name: Get pnpm store directory
        run: echo "STORE_PATH=$(pnpm store path --silent)" >> $GITHUB_ENV;
      - id: cache-pnpm-store
        name: Cache pnpm files
        uses: actions/cache@v3
        with:
          path: ${{ env.STORE_PATH }}
          key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.json') }}
          restore-keys: ${{ runner.os }}-pnpm-store-
      - name: Set NPM Registry to Verdaccio:31313 or NPM_MIRROR
        run: pnpm set registry ${NPM_DEFAULT:-http://localhost:31313};
      - if: ${{ steps.cache-npm.outputs.cache-hit != 'true' }}
        name: List Dependencies
        continue-on-error: true
        run: pnpm list;
      - name: Install Dependencies
        run: pnpm install;
      - name: Build image
        run: |-
          if [ -z "$DOCKER_NO_IMAGE" ]; then 
          													pnpm exec nx pack:build iac-images-application --verbose; 
          												fi;
      - name: Verify AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-region: ${{ env.AWS_REGION }}
      - name: Setup Pulumi state backend
        run: |-
          echo "Retriving AWS credentials with pnpm dx:cli:bin aws in $AWS_REGION";
          pnpm dx:cli:bin;
          STRUCTURED_LOGGING=quiet pnpm dx:cli:bin aws pulumi ci --region $AWS_REGION > .pulumi-ci;
      - name: Display Pulumi CI output
        run: cat .pulumi-ci;
      - name: Extract exports from Pulumi CI
        run: cat .pulumi-ci | grep "export" > .export-cd;
      - name: Load environment variables
        run: cat .export-cd;
      - name: Create Pulumi Helper Functions
        run: |-
          cat > .pulumi-helper.sh << 'EOF'
          configure_stack() {
            local step="$1"
            local stack_name="$2"
            local stack_cwd="$3"
            local project="$4"
            local output="$5"

            echo "${step}: Stack: ${stack_name}. CWD: ${stack_cwd}. Output: ${output}."
            echo "name: ${project}" >> "${stack_cwd}/Pulumi.yaml"
            cat "${stack_cwd}"/Pulumi.{yaml,"*".yaml} || true
          }

          setup_stack() {
            local stack_name="$1"
            local stack_cwd="$2"
            
            echo "Setting up stack: ${stack_name}. CWD: ${stack_cwd}."
            for cmd in init select; do
              pulumi stack ${cmd} ${stack_name} -C ${stack_cwd} || true
            done
          }

          configure_stack_settings() {
            local stack_cwd="$1"
            local configs="$2"
            
            echo "Configuring stack settings"
            
            while IFS= read -r line; do
              if [[ -n "$line" ]]; then
                key="${line%%=*}"
                value="${line#*=}"
                
                # Expand variables in value
                eval "value="$value""
                
                if [[ -n "$key" && -n "$value" ]]; then
                  echo "Setting $key to $value"
                  pulumi config set --path "$key" "$value" -C "$stack_cwd"
                fi
              fi
            done <<< "$configs"
          }

          refresh_and_preview() {
            local message="$1"
            local stack_cwd="$2"
            shift 2
            local default_args="$@"

            pulumi refresh --yes --skip-preview --clear-pending-creates --message "${message}-refresh" -C "${stack_cwd}" ${default_args}
            pulumi preview --show-replacement-steps --message "${message}-preview" -C "${stack_cwd}" ${default_args} || true
          }

          deploy_stack() {
            local message="$1"
            local stack_cwd="$2"
            shift 2
            local default_args="$@"

            pulumi up --yes --message "${message}-up" -C "${stack_cwd}" ${default_args}
          }

          remove_stack() {
          	local message="$1"
          	local stack_cwd="$2"
          	shift 2
          	local default_args="$@"
            
          	pulumi down --yes --message "${message}-down" -C "${stack_cwd}" ${default_args}
            }
            
          capture_outputs() {
            local stack_cwd="$1"
            local output="$2"

            pulumi stack output -C "${stack_cwd}" --json > "$(pwd)/${output}.json"
            cat "${output}.json"
            pulumi stack output -C "${stack_cwd}" --shell > "$(pwd)/${output}.sh"
            cat "${output}.sh"
            ls _pulumi
            chmod +x "$(pwd)/${output}.sh"
            echo "Output captured in ${output}.sh"
          }
          EOF
          chmod +x .pulumi-helper.sh
          source .pulumi-helper.sh;
      - name: Deploy fourtwo stacks
        run: |-
          mkdir -p _pulumi;
          source .export-cd;
          pnpm build:tsc;
          pnpm -C packages/builders build:tsc;
          pnpm -C packages/pulumi build:tsc;
          source .pulumi-helper.sh;
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-application" ]; then
          															echo "Stack fourtwo-application matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-application,"; then
          															echo "Stack fourtwo-application found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-application not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-application.elm_pst_4" "$(pwd)/iac/stacks/src/application" "fourtwo-application" "_pulumi/application";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-application" ]; then
          															echo "Stack fourtwo-application matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-application,"; then
          															echo "Stack fourtwo-application found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-application not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-application.elm_pst_4" "$(pwd)/iac/stacks/src/application";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-application" ]; then
          															echo "Stack fourtwo-application matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-application,"; then
          															echo "Stack fourtwo-application found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-application not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/application" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-application" ]; then
          															echo "Stack fourtwo-application matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-application,"; then
          															echo "Stack fourtwo-application found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-application not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/application" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-application.elm_pst_4 processed";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-codestar" ]; then
          															echo "Stack fourtwo-codestar matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-codestar,"; then
          															echo "Stack fourtwo-codestar found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-codestar not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-codestar.elm_pst_4" "$(pwd)/iac/stacks/src/codestar" "fourtwo-codestar" "_pulumi/codestar";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-codestar" ]; then
          															echo "Stack fourtwo-codestar matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-codestar,"; then
          															echo "Stack fourtwo-codestar found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-codestar not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-codestar.elm_pst_4" "$(pwd)/iac/stacks/src/codestar";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-codestar" ]; then
          															echo "Stack fourtwo-codestar matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-codestar,"; then
          															echo "Stack fourtwo-codestar found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-codestar not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/codestar" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-codestar" ]; then
          															echo "Stack fourtwo-codestar matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-codestar,"; then
          															echo "Stack fourtwo-codestar found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-codestar not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/codestar" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-codestar.elm_pst_4 processed";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-identity-oidc" ]; then
          															echo "Stack fourtwo-identity-oidc matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-identity-oidc,"; then
          															echo "Stack fourtwo-identity-oidc found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-identity-oidc not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-identity-oidc.elm_pst_4" "$(pwd)/iac/stacks/src/identity/oidc" "fourtwo-identity-oidc" "_pulumi/identity_oidc";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-identity-oidc" ]; then
          															echo "Stack fourtwo-identity-oidc matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-identity-oidc,"; then
          															echo "Stack fourtwo-identity-oidc found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-identity-oidc not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-identity-oidc.elm_pst_4" "$(pwd)/iac/stacks/src/identity/oidc";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-identity-oidc" ]; then
          															echo "Stack fourtwo-identity-oidc matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-identity-oidc,"; then
          															echo "Stack fourtwo-identity-oidc found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-identity-oidc not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/identity/oidc" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-identity-oidc" ]; then
          															echo "Stack fourtwo-identity-oidc matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-identity-oidc,"; then
          															echo "Stack fourtwo-identity-oidc found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-identity-oidc not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/identity/oidc" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-identity-oidc.elm_pst_4 processed";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-identity-users" ]; then
          															echo "Stack fourtwo-identity-users matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-identity-users,"; then
          															echo "Stack fourtwo-identity-users found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-identity-users not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-identity-users.elm_pst_4" "$(pwd)/iac/stacks/src/identity/users" "fourtwo-identity-users" "_pulumi/identity_users";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-identity-users" ]; then
          															echo "Stack fourtwo-identity-users matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-identity-users,"; then
          															echo "Stack fourtwo-identity-users found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-identity-users not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-identity-users.elm_pst_4" "$(pwd)/iac/stacks/src/identity/users";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-identity-users" ]; then
          															echo "Stack fourtwo-identity-users matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-identity-users,"; then
          															echo "Stack fourtwo-identity-users found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-identity-users not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/identity/users" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-identity-users" ]; then
          															echo "Stack fourtwo-identity-users matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-identity-users,"; then
          															echo "Stack fourtwo-identity-users found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-identity-users not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/identity/users" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-identity-users.elm_pst_4 processed";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-datalayer" ]; then
          															echo "Stack fourtwo-datalayer matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-datalayer,"; then
          															echo "Stack fourtwo-datalayer found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-datalayer not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-datalayer.elm_pst_4" "$(pwd)/iac/stacks/src/datalayer" "fourtwo-datalayer" "_pulumi/datalayer";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-datalayer" ]; then
          															echo "Stack fourtwo-datalayer matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-datalayer,"; then
          															echo "Stack fourtwo-datalayer found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-datalayer not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-datalayer.elm_pst_4" "$(pwd)/iac/stacks/src/datalayer";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-datalayer" ]; then
          															echo "Stack fourtwo-datalayer matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-datalayer,"; then
          															echo "Stack fourtwo-datalayer found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-datalayer not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/datalayer" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-datalayer" ]; then
          															echo "Stack fourtwo-datalayer matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-datalayer,"; then
          															echo "Stack fourtwo-datalayer found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-datalayer not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/datalayer" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-datalayer.elm_pst_4 processed";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-dns-root" ]; then
          															echo "Stack fourtwo-dns-root matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-dns-root,"; then
          															echo "Stack fourtwo-dns-root found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-dns-root not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-dns-root.elm_pst_4" "$(pwd)/iac/stacks/src/dns/root" "fourtwo-dns-root" "_pulumi/dns_root";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-dns-root" ]; then
          															echo "Stack fourtwo-dns-root matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-dns-root,"; then
          															echo "Stack fourtwo-dns-root found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-dns-root not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-dns-root.elm_pst_4" "$(pwd)/iac/stacks/src/dns/root";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-dns-root" ]; then
          															echo "Stack fourtwo-dns-root matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-dns-root,"; then
          															echo "Stack fourtwo-dns-root found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-dns-root not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/dns/root" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-dns-root" ]; then
          															echo "Stack fourtwo-dns-root matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-dns-root,"; then
          															echo "Stack fourtwo-dns-root found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-dns-root not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/dns/root" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-dns-root.elm_pst_4 processed";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-client" ]; then
          															echo "Stack fourtwo-panel-client matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-client,"; then
          															echo "Stack fourtwo-panel-client found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-client not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-panel-client.elm_pst_4" "$(pwd)/iac/stacks/src/levicape/panel/client" "fourtwo-panel-client" "_pulumi/levicape_panel_client";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-client" ]; then
          															echo "Stack fourtwo-panel-client matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-client,"; then
          															echo "Stack fourtwo-panel-client found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-client not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-panel-client.elm_pst_4" "$(pwd)/iac/stacks/src/levicape/panel/client";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-client" ]; then
          															echo "Stack fourtwo-panel-client matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-client,"; then
          															echo "Stack fourtwo-panel-client found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-client not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/levicape/panel/client" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-client" ]; then
          															echo "Stack fourtwo-panel-client matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-client,"; then
          															echo "Stack fourtwo-panel-client found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-client not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/levicape/panel/client" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-panel-client.elm_pst_4 processed";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-http" ]; then
          															echo "Stack fourtwo-panel-http matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-http,"; then
          															echo "Stack fourtwo-panel-http found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-http not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-panel-http.elm_pst_4" "$(pwd)/iac/stacks/src/levicape/panel/http" "fourtwo-panel-http" "_pulumi/levicape_panel_http";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-http" ]; then
          															echo "Stack fourtwo-panel-http matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-http,"; then
          															echo "Stack fourtwo-panel-http found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-http not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-panel-http.elm_pst_4" "$(pwd)/iac/stacks/src/levicape/panel/http";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-http" ]; then
          															echo "Stack fourtwo-panel-http matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-http,"; then
          															echo "Stack fourtwo-panel-http found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-http not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/levicape/panel/http" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-http" ]; then
          															echo "Stack fourtwo-panel-http matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-http,"; then
          															echo "Stack fourtwo-panel-http found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-http not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/levicape/panel/http" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-panel-http.elm_pst_4 processed";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-web" ]; then
          															echo "Stack fourtwo-panel-web matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-web,"; then
          															echo "Stack fourtwo-panel-web found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-web not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-panel-web.elm_pst_4" "$(pwd)/iac/stacks/src/levicape/panel/web" "fourtwo-panel-web" "_pulumi/levicape_panel_web";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-web" ]; then
          															echo "Stack fourtwo-panel-web matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-web,"; then
          															echo "Stack fourtwo-panel-web found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-web not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-panel-web.elm_pst_4" "$(pwd)/iac/stacks/src/levicape/panel/web";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-web" ]; then
          															echo "Stack fourtwo-panel-web matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-web,"; then
          															echo "Stack fourtwo-panel-web found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-web not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/levicape/panel/web" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-web" ]; then
          															echo "Stack fourtwo-panel-web matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-web,"; then
          															echo "Stack fourtwo-panel-web found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-web not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/levicape/panel/web" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-panel-web.elm_pst_4 processed";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-monitor" ]; then
          															echo "Stack fourtwo-panel-monitor matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-monitor,"; then
          															echo "Stack fourtwo-panel-monitor found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-monitor not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-panel-monitor.elm_pst_4" "$(pwd)/iac/stacks/src/levicape/panel/monitor" "fourtwo-panel-monitor" "_pulumi/levicape_panel_monitor";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-monitor" ]; then
          															echo "Stack fourtwo-panel-monitor matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-monitor,"; then
          															echo "Stack fourtwo-panel-monitor found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-monitor not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-panel-monitor.elm_pst_4" "$(pwd)/iac/stacks/src/levicape/panel/monitor";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-monitor" ]; then
          															echo "Stack fourtwo-panel-monitor matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-monitor,"; then
          															echo "Stack fourtwo-panel-monitor found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-monitor not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/levicape/panel/monitor" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-monitor" ]; then
          															echo "Stack fourtwo-panel-monitor matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-monitor,"; then
          															echo "Stack fourtwo-panel-monitor found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-monitor not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/levicape/panel/monitor" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-panel-monitor.elm_pst_4 processed";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-wwwroot" ]; then
          															echo "Stack fourtwo-panel-wwwroot matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-wwwroot,"; then
          															echo "Stack fourtwo-panel-wwwroot found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-wwwroot not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack "Preview" "fourtwo-panel-wwwroot.elm_pst_4" "$(pwd)/iac/stacks/src/levicape/panel/wwwroot" "fourtwo-panel-wwwroot" "_pulumi/levicape_panel_wwwroot";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-wwwroot" ]; then
          															echo "Stack fourtwo-panel-wwwroot matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-wwwroot,"; then
          															echo "Stack fourtwo-panel-wwwroot found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-wwwroot not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && setup_stack "fourtwo-panel-wwwroot.elm_pst_4" "$(pwd)/iac/stacks/src/levicape/panel/wwwroot";
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-wwwroot" ]; then
          															echo "Stack fourtwo-panel-wwwroot matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-wwwroot,"; then
          															echo "Stack fourtwo-panel-wwwroot found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-wwwroot not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && configure_stack_settings "$(pwd)/iac/stacks/src/levicape/panel/wwwroot" 'aws:skipMetadataApiCheck=false
          context:stack.environment.isProd=false
          context:stack.environment.features=aws
          frontend:stack.dns.hostnames[0]=elm_pst_4.fourtwo.$FRONTEND_HOSTNAME';
          if [ -n "$PULUMI_STACK_FILTER" ]; then
          														if [ "$PULUMI_STACK_FILTER" = "*" ]; then
          															echo "Running all stacks due to wildcard filter"
          															true
          														elif [ "$PULUMI_STACK_FILTER" = "fourtwo-panel-wwwroot" ]; then
          															echo "Stack fourtwo-panel-wwwroot matched in filter"
          															true
          														elif echo ",$PULUMI_STACK_FILTER," | grep -q ",fourtwo-panel-wwwroot,"; then
          															echo "Stack fourtwo-panel-wwwroot found in comma-separated list"
          															true
          														else
          															echo "Stack fourtwo-panel-wwwroot not in filter '$PULUMI_STACK_FILTER', skipping"
          															false
          														fi
          													else
          														echo "No stack filter specified, processing all stacks"
          														true
          													fi && refresh_and_preview "${{ github.ref_name }}-${{ github.sha }}" "$(pwd)/iac/stacks/src/levicape/panel/wwwroot" --non-interactive --suppress-progress --diff --json;
          echo "Stack fourtwo-panel-wwwroot.elm_pst_4 processed";
      - name: Cleanup
        run: |-
          rm -f .pulumi-ci .export-cd .pulumi-helper.sh .ci-env;
          rm -rf _pulumi;

########################################
########################################
#**:_$~- {"$$":"head","filename":"[wd][dispatch] - CD - [elm_pst_4 Dispatch: Preview].yml","source":"iac/workflows/github/workflow_dispatch/CD.js"}
#**:_$~- {"$$":"script","generator":"codegen/github/GenerateGithubWorkflow.mts"}
#**:_$~- {"$$":"body","hashed":"46ba68827e0e48777ee02fec7ddce607c84101b88856576fe53b754d3c439624"}
#**:_$~- {"$$":"footer","started":"2025-03-22T08:50:54.459Z","now":"2025-03-22T08:50:54.466Z","elapsed":"7ms"}
# END OF GENERATED FILE

